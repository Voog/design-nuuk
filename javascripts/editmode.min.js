!function(u){function d(e,t){.5<=t?u(e).addClass("light-background").removeClass("dark-background"):u(e).addClass("dark-background").removeClass("light-background")}function i(e,t){return function(i,a){if(i&&a){"string"==typeof i&&(i=i.replace(/rgba?\(/,"").replace(/\)/,"").split(","),u.each(i,function(e,t){i[e]=+t})),"string"==typeof a&&(a=a.replace(/rgba?\(/,"").replace(/\)/,"").split(","),u.each(a,function(e,t){a[e]=+t})),"object"==typeof i&&i.hasOwnProperty("length")&&3==i.length&&i.push(1),"object"==typeof a&&a.hasOwnProperty("length")&&3==a.length&&a.push(1);var e=[0,0,0,0];return e[3]=1-(1-a[3])*(1-i[3]),0===e[3]&&(e[3]=1e-6),e[0]=Math.min(a[0]*a[3]/e[3]+i[0]*i[3]*(1-a[3])/e[3],255),e[1]=Math.min(a[1]*a[3]/e[3]+i[1]*i[3]*(1-a[3])/e[3],255),e[2]=Math.min(a[2]*a[3]/e[3]+i[2]*i[3]*(1-a[3])/e[3],255),u.map(e,function(e){return Math.floor(e)})}}(e||[255,255,255,1],t||[255,255,255,1])}var m=function(e,t){t=i(e,t);return Math.round((.2126*+t[0]+.7152*+t[1]+.0722*+t[2])/2.55)/100},l=function(e,t){e.find(".image_settings").show(),e.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),t.removeClass("is-hidden").addClass("is-visible")},g=function(e,t){e=e.closest(".js-content-item-box");e.find(".top-inner").append('<div class="edy-img-drop-area-placeholder">'+t+"</div>"),e.find(".top-inner").attr("style",""),e.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),e.find(".edy-img-drop-area").removeClass("active"),e.find(".image_settings").hide(),e.find(".image_settings-remove--input").val(""),e.find(".image_settings-remove--input").trigger("change"),e.find(".form_field-cms").removeClass("with-input")};handleProductImage=function(e,t,a,o){var s=u(".js-buy-btn-content  .partial .edy-buy-button-container").data("product-id"),n=u(".js-product-page-image .image-drop-area");u.ajax({type:"GET",contentType:"application/json",url:"/admin/api/pages/"+t,dataType:"json"}).then(function(t){function i(){o.closest(".content-item-box").find(".edy-img-drop-area-placeholder").length<1&&g(o,e)}a?t.data.item_image?(n.css("background-image","url("+t.data.item_image.url+")"),u(".js-remove-image").css("display","flex")):a.detail.product.image?(u(".image_settings").css("display","flex"),u(".js-remove-image").css("display","none"),u(".edy-img-drop-area-placeholder").remove(),l(n.closest(".js-content-item-box"),n.find(".js-toggle-crop-state")),n.css("background-image","url("+a.detail.product.image.url+")")):r(t.image)?u(".edy-img-drop-area-placeholder").length<1&&g(n,e):(n.css("background-image","url("+t.image.public_url+")"),u(".js-remove-image").css("display","flex")):s?u.ajax({type:"GET",contentType:"application/json",url:"/admin/api/ecommerce/v1/products/"+s+"?include=details",dataType:"json"}).then(function(e){e.image?(u(".image_settings").css("display","flex"),u(".js-remove-image").css("display","none"),u(".edy-img-drop-area-placeholder").remove(),l(n.closest(".js-content-item-box"),n.find(".js-toggle-crop-state")),n.css("background-image","url("+e.image.url+")")):r(t.image)?i():(n.css("background-image","url("+t.image.public_url+")"),u(".js-remove-image").css("display","flex"))}):i()})};var r=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})};window.site=u.extend(window.site||{},{bgPickerCommit:function(e,t,i,a){var o,s=u.extend(!0,{},t);s.image=t.image||"",s.imageSizes=null==(o=t.imageSizes)||"string"==typeof o&&o.match(/^[\\'"]+$/)?"":o,s.color=t.color||"",s.combinedLightness=i.combinedLightness,"siteData"==a?siteData.set(e,s):"articleData"==a?Edicy.articles.currentArticle.setData(e,s):pageData.set(e,s)},bgPickerPreview:function(t,e,i){var a=t.bg&&t.bg.image||"",o=e.imageSizes?function(e,t){for(var i,a=0,o=e.length;a<o;a++){if(e[a].width<t)return i||e[a];i=e[a]}return e[e.length-1]}(e.imageSizes,u(window).width()):null,s=(e.image&&""!==e.image&&o.url,e.imageSizes&&""!==e.imageSizes?e.imageSizes:null),n=e.color&&""!==e.color?e.color:"rgba(0,0,0,0)",r=(e.colorData&&""!==e.colorData&&e.colorData.lightness,u("<img>")),c=u("<canvas>"),l=e.image&&""!==e.image?e.image:null;l?!function(e,t){for(var i=e.length;i--;)if(-1<t.indexOf(e[i].url.trim()))return!0;return!1}(s,a)?(r.attr("src",l.replace(/.*\/(photos|voogstock)/g,"/photos")),r.on("load",function(){ColorExtract.extract(r[0],c[0],function(e){i.imageColor=e.bgColor||"rgba(255,255,255,1)",i.combinedLightness=m(i.imageColor,n),d(t.picker_area_elem,i.combinedLightness)})})):(i.imageColor=i.imageColor||"rgba(255,255,255,1)",i.combinedLightness=m(i.imageColor,n),d(t.picker_area_elem,i.combinedLightness)):(i.imageColor="rgba(255,255,255,1)",i.combinedLightness=m(i.imageColor,n),d(t.picker_area_elem,i.combinedLightness)),(t.image_elem||t.color_elem)&&(o=u(t.image_elem),s=u(t.color_elem),a=o.closest(t.picker_area_elem),l=e.color&&""!==e.color?e.color:"transparent",e.image?(o.attr("src",e.image),o.attr("srcset",e.image),o.css("display","initial"),t.wrapper_class&&(a.hasClass(t.wrapper_class)||a.addClass(t.wrapper_class))):(o.removeAttr("src"),o.removeAttr("srcset"),o.css("display","none"),t.wrapper_class&&a.hasClass(t.wrapper_class)&&a.removeClass(t.wrapper_class)),l&&s.css("background-color",l))},bindContentItemImageCropToggle:function(a){u(".js-toggle-crop-state").on("click",function(){var e=u(this).closest(".js-content-item-box"),t=e.find(".js-content-item-img-drop-area"),i=e.data("item-id"),e=e.data("item-type"),i=new Edicy.CustomData({type:e,id:i}),t=t.hasClass("is-cropped")?(t.removeClass("is-cropped").addClass("not-cropped"),"not-cropped"):(t.removeClass("not-cropped").addClass("is-cropped"),"is-cropped");i.set(a,t)})},bindContentItemImgDropAreas:function(n,r,c){u(".js-content-item-img-drop-area").each(function(e,t){var a=u(t),s=a.closest(".js-content-item-box"),t=s.find(".image_settings-remove");itemId=s.data("item-id"),itemType=s.data("item-type"),itemImageType=s.data("image-type"),itemData=new Edicy.CustomData({type:itemType,id:itemId});new Edicy.ImgDropArea(a,{positionable:!1,target_width:2048,placeholder:'<div class="edy-img-drop-area-placeholder">'+n+"</div>",removeBtn:null,change:function(e){var t=s.find(".js-toggle-crop-state");a.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),e?(l(s,t),u(".js-remove-image").css("display","flex")):(s.find(".image_settings").hide(),s.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),t.addClass("is-hidden").removeClass("is-visible"),s.find(".edy-img-drop-area-placeholder").css("opacity",0));var i=s.data("item-type"),t=s.data("item-id");new Edicy.CustomData({type:i,id:t}).set({[c]:"not-cropped",[r]:e}),s.removeClass("not-loaded with-error").addClass("is-loaded"),s.find(".edy-img-drop-area-placeholder").css("opacity",1),a.css("opacity",1)}});t.on("click",function(){var t=u(this),i=s.data("item-id"),a=s.data("item-type"),o=new Edicy.CustomData({type:a,id:i});o.get({success:function(e){e.item_image?o.remove(r,{success:function(e){o.remove(c,{success:function(e){"article"!==a?handleProductImage(n,i,null,t):g(t,n)}})}}):u.ajax({type:"PUT",contentType:"application/json",url:"/admin/api/pages/"+i,dataType:"json",data:JSON.stringify({image_id:null})}).then(function(e){g(t,n)})}})})})},bindCustomTexteditorStyles:function(e){window.edy=window.edy||[],edy.push(["texteditorStyles",{name:e,tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}])},bindProductListeners:function(t,i){document.addEventListener("voog:ecommerce:buttonproductsave",function(e){handleProductImage(t,i,e)})},initProductPageSettings:function(t){"is_related_product_1"in valuesObj||(valuesObj.is_related_product_1=0),"is_related_product_2"in valuesObj||(valuesObj.is_related_product_2=0),"is_related_product_3"in valuesObj||(valuesObj.is_related_product_3=0);function s(t,i){return new Promise(function(a,e){u.ajax({type:"GET",contentType:"application/json",url:"/admin/api/buy_buttons?q.content.parent_type=page&q.content.language_id="+i+"&per_page=250&page="+t,dataType:"json",success:function(e,t,i){i=parseInt(i.getResponseHeader("X-Total-Pages"));a({products:e,nPages:i})},error:function(){window.console&&window.console.error&&console.error("Error while getting related products list"),e()}})})}var n=function(i,a,o){return new Promise(function(t,e){s(i,a).then(function(e){e.nPages<i?t(o):(e.products.forEach(function(e){o.push(e)}),t(n(i+1,a,o)))}).catch(function(){e()})})},a=function(e){var t=[{title:"---",value:0}];return e.forEach(function(e){e.product&&t.push({title:e.product.name+" ("+e.parent.title+")",value:e.parent.id})}),t.sort(function(e,t){e=e.title.toUpperCase(),t=t.title.toUpperCase();return e<t?-1:t<e?1:0}),t};u(".js-layout_settings-btn").one("click",function(e){var i;i=t.pageLanguageId,new Promise(function(t,e){n(1,i,[]).then(function(e){t(a(e))}).catch(function(){e()})}).then(function(e){initSettingsEditor({settingsBtn:document.querySelector(".js-product-page-settings-btn"),menuItems:[{title:t.selectRelatedProduct,type:"select",key:"is_related_product_1",list:e},{title:t.selectRelatedProduct,type:"select",key:"is_related_product_2",list:e},{title:t.selectRelatedProduct,type:"select",key:"is_related_product_3",list:e},{title:t.addProductLabel,type:"text",key:"product_label",placeholder:t.addProductLabel},{title:t.crossOutLabel,type:"checkbox",key:"is_product_label_line_through",states:{on:!0,off:!1}},{title:t.borderAroundLabel,type:"checkbox",key:"is_product_label_box",states:{on:!0,off:!1}}],dataKey:t.dataKey,containerClass:["bottom-settings-popover","first","editor_default"],values:t.valuesObj})})})},initSettingsEditorBtn:function(){window.addEventListener("DOMContentLoaded",function(e){var l=document.querySelector(".edy-next-shadowdom").shadowRoot,d=setInterval(function(){var e,t,a,i,o,s,n,r,c;l.querySelectorAll('div[class^="toolbar__"]').length&&(e=l.querySelector('div[class^="toolbar-expand"]'),t=l.querySelector('div[class^="toolbar__"]'),a=document.querySelector(".js-layout_settings-btn"),i=l.querySelector('div[class^="toolbar-content-item__"]'),a.className=i.className+" "+a.className,t.insertBefore(a,e),l.querySelector(".js-layout_settings-btn").addEventListener("click",function(e){document.querySelector("body").classList.toggle("layout_settings-visible"),e.stopImmediatePropagation()}),l.querySelector(".js-layout_settings-btn").addEventListener("mouseenter",function(e){u(".layout_settings-tooltip").addClass("visible"),o()}),l.querySelector(".js-layout_settings-btn").addEventListener("mouseleave",function(e){u(".layout_settings-tooltip").removeClass("visible")}),o=function(){var e=u(".js-layout_settings-popover"),t=u(".layout_settings-arrow"),i=u(".layout_settings-tooltip");768<u(window).width()?(e.css({right:window.innerWidth-a.getBoundingClientRect().right-e.width()/2}),i.css({right:window.innerWidth-a.getBoundingClientRect().right-i.width()/2-a.getBoundingClientRect().width/2}),t.css({right:e.width()/2})):(e.css({right:0}),i.css({right:0}),t.css({right:72}))},u(window).resize((s=function(){o()},n=25,function(){var e=this,t=arguments,i=r&&!c;clearTimeout(c),c=setTimeout(function(){c=null,r||s.apply(e,t)},n),i&&s.apply(e,t)})),o(),clearInterval(d))},500);u("body").append(u(".js-layout_settings-popover"))})}}),u(".js-data-item").each(function(){u(this).on("change",function(e){var t;t="checkbox"===e.target.type?e.target.checked:e.target.value;var i=e.target.dataset.name,a=e.target.dataset.id,o=e.target.dataset.entity,s=e.target.dataset.reload;("site"==o?new Edicy.CustomData({type:"site"}):new Edicy.CustomData({type:o,id:a})).set({[i]:t},{success:function(){s&&location.reload()}})})}),u(".form_field-cms input").length&&(1<=u(".form_field-cms input").val().length?u(".form_field-cms input").closest(".form_field-cms").addClass("with-input"):u(".form_field-cms input").closest(".form_field-cms").removeClass("with-input")),u(document).ready(function(){u(".form_field-cms input").keyup(function(e){1<=u(this).val().length?u(this).closest(".form_field-cms").addClass("with-input"):u(this).closest(".form_field-cms").removeClass("with-input")})})}(jQuery);